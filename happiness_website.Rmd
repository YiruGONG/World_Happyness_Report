---
title: "Happiness_website"
output: 
  html_document:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
library(tidyverse)
library(countrycode)
library(plotly)
library(dplyr)

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

Jiaqi Chen (jc5681),
Xinran Sun (xs2447),
Yiru Gong (yg2832),
Yunlin Zhou (yz4184)

## Data Input

```{r}
happy_df = readxl::read_xls('DataPanelWHR2021C2.xls') %>% 
  janitor::clean_names()

```


# World map of Happiness

Install countrycode package using `install.packages("countrycode")` if needed.

We want to use a plotly to show the happiness score around the world. We add a country_code column which provides the iso3 code of each country because plotly need iso3 country code to draw country map. We also delete Kosovo and Somaliland region because they do not have corresponding iso3 code. 

```{r}
happy_iso3 = happy_df %>% 
  subset(
    country_name != "Kosovo" & country_name != "Somaliland region"
  ) %>% 
  mutate(
    country_code = countrycode(country_name, "country.name", "iso3c")
  ) %>% 
  relocate(country_code)
```

We focus on Year 2018 because we want to know the happiness score before COVID-19. Each country's life ladder (happiness) score is shown on the map. 

```{r}
plot_2018_map = happy_iso3 %>% 
  filter(year == 2018) %>% 
  plot_ly(
    type = 'choropleth', locations = ~country_code, z = ~life_ladder,
    text = ~country_name
  )

plot_2018_map
```

# Happiness score Rank (2018, bar plot)

```{r}
score_rank = 
  happy_df %>% 
  filter(year == "2018") %>% 
  arrange(life_ladder) %>% 
  mutate(
    country_name = factor(country_name, levels = country_name)
  )

score_rank %>% 
  plot_ly(x = ~life_ladder, y = ~country_name, color = ~country_name, type = "bar", colors = "viridis")
```


# Yearly Trend (line plot)
```{r}
yearly_trend = 
  happy_df %>% 
  filter(country_name == "Denmark" | country_name == "United States" | country_name == "China" | country_name == "Afghanistan" | country_name == "Mongolia" | country_name == "Haiti") %>% 
  ggplot(aes(group = country_name, x = year, y = life_ladder, color = country_name)) + geom_point(alpha = .5) + geom_line() 

yearly_trend
```


# Factors Related to Happiness Score

# Regression Model

